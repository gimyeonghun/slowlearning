---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import PostContainer from "../components/PostContainer.astro";
import Pagination from "../components/Pagination.astro";

const POSTS_PER_PAGE = 10;
const isDev = import.meta.env.DEV;

const allPosts = (await getCollection("posts"))
    .filter((post) => isDev || !post.data.draft)
    .filter((post) => !post.data.hide)
    .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const totalPages = Math.ceil(allPosts.length / POSTS_PER_PAGE);
const paginatedPosts = allPosts.slice(0, POSTS_PER_PAGE);
---

<BaseLayout title="Home">
    <Fragment slot="main">
        <PostContainer posts={paginatedPosts} />
    </Fragment>
    <Fragment slot="side-bar">
        <p>
            A learning blog by Brian Kim.
        </p>
    </Fragment>
    <Fragment slot="pagination">
        <Pagination
                totalPages={totalPages}
                currentPage={1}
                rootURL={"/"}
            />
    </Fragment>
</BaseLayout>
