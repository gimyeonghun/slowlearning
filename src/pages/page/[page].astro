---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import PostContainer from "../../components/PostContainer.astro";

export async function getStaticPaths({ paginate }) {
    const isDev = import.meta.env.DEV;
    const allPosts = (await getCollection("posts"))
        .filter((post) => isDev || !post.data.draft)
        .filter((post) => !post.data.hide)
        .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

    return paginate(allPosts, { pageSize: 10 });
}

const { page } = Astro.props;
---

<BaseLayout title={`Page ${page.currentPage}`}>
    <h1>Page {page.currentPage}</h1>

    <PostContainer posts={page.data} />

    <nav class="flex justify-center gap-2 mt-12" aria-label="Pagination">
        {
            page.url.prev ? (
                <a
                    href={page.url.prev}
                    class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded"
                >
                    ← Previous
                </a>
            ) : null
        }

        {
            Array.from({ length: page.lastPage }, (_, i) => i + 1).map(
                (pageNumber) =>
                    pageNumber === page.currentPage ? (
                        <span class="px-4 py-2 bg-blue-600 text-white rounded">
                            {pageNumber}
                        </span>
                    ) : (
                        <a
                            href={
                                pageNumber === 1 ? "/" : `/page/${pageNumber}`
                            }
                            class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded"
                        >
                            {pageNumber}
                        </a>
                    ),
            )
        }

        {
            page.url.next ? (
                <a
                    href={page.url.next}
                    class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded"
                >
                    Next →
                </a>
            ) : null
        }
    </nav>
</BaseLayout>
