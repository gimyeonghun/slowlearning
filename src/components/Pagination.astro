---
const { totalPages, page, currentPage, rootURL } = Astro.props;

function getPageNumbers(total: number, currentPageNumber: number) {
    // Always show all pages if total is small
    if (total <= 9) {
        return Array.from({ length: total }, (_, i) => i + 1);
    }

    const PAGES_TO_SHOW = 7; // Number of page buttons to show (excluding ellipsis)
    const BOUNDARY_PAGES = 2; // Pages to always show at start/end
    const SURROUNDING_PAGES = 2; // Pages to show around current page

    const pages: (number | string)[] = [];
    
    // Calculate the range around current page
    const startPage = Math.max(2, currentPageNumber - SURROUNDING_PAGES);
    const endPage = Math.min(total - 1, currentPageNumber + SURROUNDING_PAGES);
    
    // Always show first page
    pages.push(1);
    
    // Add ellipsis or pages after first page
    if (startPage > 2) {
        pages.push("...");
    } else if (startPage === 2) {
        pages.push(2);
    }
    
    // Add pages around current page
    for (let i = Math.max(startPage, 2); i <= Math.min(endPage, total - 1); i++) {
        if (!pages.includes(i)) {
            pages.push(i);
        }
    }
    
    // Add ellipsis or pages before last page
    if (endPage < total - 1) {
        pages.push("...");
    } else if (endPage === total - 1 && !pages.includes(total - 1)) {
        pages.push(total - 1);
    }
    
    // Always show last page
    if (!pages.includes(total)) {
        pages.push(total);
    }
    
    return pages;
}
---

{
    page && (
        <nav class="flex justify-center gap-2 mt-12" aria-label="Pagination">
            {page.url.prev ? (
                <a
                    href={page.url.prev}
                    class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded"
                >
                    ← Previous
                </a>
            ) : null}

            {Array.from({ length: page.lastPage }, (_, i) => i + 1).map(
                (pageNumber) =>
                    pageNumber === page.currentPage ? (
                        <span class="px-4 py-2 bg-blue-600 text-white rounded">
                            {pageNumber}
                        </span>
                    ) : (
                        <a
                            href={
                                pageNumber === 1
                                    ? rootURL
                                    : `/page/${pageNumber}`
                            }
                            class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded"
                        >
                            {pageNumber}
                        </a>
                    ),
            )}

            {page.url.next ? (
                <a
                    href={page.url.next}
                    class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded"
                >
                    Next →
                </a>
            ) : null}
        </nav>
    )
}

{
    totalPages > 1 && (
        <nav class="flex justify-center mt-12" aria-label="Pagination">
            <div class="isolate -space-x-px shadow-xs dark:shadow-none flex items-center">
                {
                currentPage === 1 ? (
                <span
                    class="cursor-not-allowed relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 inset-ring inset-ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 dark:inset-ring-gray-700 dark:hover:bg-white/5"
                >
                    <span class="sr-only">Next</span>
                    <svg
                        viewBox="0 0 20 20"
                        fill="currentColor"
                        data-slot="icon"
                        aria-hidden="true"
                        class="size-5"
                    >
                        <path
                            d="M11.78 5.22a.75.75 0 0 1 0 1.06L8.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z"
                            clip-rule="evenodd"
                            fill-rule="evenodd"
                        />
                    </svg>
                </span>
                ) : (
                <a
                    href=`${rootURL}page/${currentPage -1}`
                    class="relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 inset-ring inset-ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 dark:inset-ring-gray-700 dark:hover:bg-white/5"
                >
                    <span class="sr-only">Next</span>
                    <svg
                        viewBox="0 0 20 20"
                        fill="currentColor"
                        data-slot="icon"
                        aria-hidden="true"
                        class="size-5"
                    >
                        <path
                            d="M11.78 5.22a.75.75 0 0 1 0 1.06L8.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z"
                            clip-rule="evenodd"
                            fill-rule="evenodd"
                        />
                    </svg>
                </a>
                )
                }


                {getPageNumbers(totalPages, currentPage).map((pageNumber) =>
                    pageNumber === "..." ? (
                        <span class="relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700 inset-ring inset-ring-gray-300 focus:outline-offset-0 dark:text-gray-400 dark:inset-ring-gray-700">
                            ...
                        </span>
                    ) : pageNumber === currentPage ? (
                        <span
                            aria-current="page"
                            class="relative z-10 inline-flex items-center bg-green-800 px-4 py-2 text-sm font-semibold text-white focus:z-20 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 dark:bg-indigo-500 dark:focus-visible:outline-indigo-500"
                        >
                            {pageNumber}
                        </span>
                    ) : (
                        <a
                            href={
                                pageNumber === 1
                                    ? rootURL
                                    : `${rootURL}page/${pageNumber}`
                            }
                            class="relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-900 inset-ring inset-ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 dark:text-gray-200 dark:inset-ring-gray-700 dark:hover:bg-white/5"
                        >
                            {pageNumber}
                        </a>
                    ),
                )}
                {
                currentPage === totalPages ? (
                <span
                    class="cursor-not-allowed relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 inset-ring inset-ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 dark:inset-ring-gray-700 dark:hover:bg-white/5"
                >
                    <span class="sr-only">Next</span>
                    <svg
                        viewBox="0 0 20 20"
                        fill="currentColor"
                        data-slot="icon"
                        aria-hidden="true"
                        class="size-5"
                    >
                        <path
                            d="M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z"
                            clip-rule="evenodd"
                            fill-rule="evenodd"
                        />
                    </svg>
                </span>
                ) : (
                <a
                    href=`${rootURL}page/${currentPage + 1}`
                    class="relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 inset-ring inset-ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 dark:inset-ring-gray-700 dark:hover:bg-white/5"
                >
                    <span class="sr-only">Next</span>
                    <svg
                        viewBox="0 0 20 20"
                        fill="currentColor"
                        data-slot="icon"
                        aria-hidden="true"
                        class="size-5"
                    >
                        <path
                            d="M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z"
                            clip-rule="evenodd"
                            fill-rule="evenodd"
                        />
                    </svg>
                </a>
                )
                }
            </div>
        </nav>
    )
}
